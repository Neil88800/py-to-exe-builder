# -*- coding: utf-8 -*-
"""Excel_å§“åçµ±è¨ˆå·¥å…·.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1xpOpCs4NbBBGDP-AbACxoLRZwXjTR4z1

# ğŸ“Š Excel å§“åçµ±è¨ˆè‡ªå‹•åŒ–å·¥å…·ï¼ˆå·¥ä½œè¡¨1 âœ å·¥ä½œè¡¨2ï¼‰
ä½¿ç”¨è€…åªéœ€ä¸Šå‚³å«ã€Œå·¥ä½œè¡¨1ã€çš„ Excel æª”ï¼Œç³»çµ±æœƒè‡ªå‹•ï¼š
- æ“·å– C æ¬„è³‡æ–™ä¸­ã€Œ-ã€å¾Œçš„å§“å
- çµ±è¨ˆæ¯å€‹å§“åå‡ºç¾æ¬¡æ•¸
- ç”¢ç”Ÿæ–°çš„ã€Œå·¥ä½œè¡¨2ã€ï¼šä¾ç…§æ¬¡æ•¸ç”±å¤šåˆ°å°‘æ’åº
- æœ€å¾Œè‡ªå‹•åŠ å…¥ç¸½è¨ˆè¡Œ

âš¡ ä¸€éµå®Œæˆä¸¦åŒ¯å‡º Excel çµæœå ±è¡¨

---
"""

# Step 1ï¼šå®‰è£å¥—ä»¶ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€åŸ·è¡Œï¼‰
!pip install pandas openpyxl

"""## Step 2ï¼šä¸Šå‚³ä½ çš„ Excel æª”æ¡ˆï¼ˆå¿…é ˆåŒ…å«åç‚ºã€Œå·¥ä½œè¡¨1ã€çš„å·¥ä½œè¡¨ï¼‰"""

from google.colab import files
uploaded = files.upload()

"""## Step 3ï¼šæ“·å–ã€çµ±è¨ˆã€å»ºç«‹æ–°å ±è¡¨"""

import pandas as pd
import io

# å–å¾—ä¸Šå‚³çš„æª”æ¡ˆåç¨±
file_name = list(uploaded.keys())[0]
xlsx = pd.ExcelFile(io.BytesIO(uploaded[file_name]))

# è®€å–å·¥ä½œè¡¨1
df1 = xlsx.parse('å·¥ä½œè¡¨1')

# æ“·å– C æ¬„å¾ç¬¬ 2 åˆ—é–‹å§‹çš„è³‡æ–™
data = df1.iloc[1:, 2].dropna().astype(str)
names = data.str.extract(r'-(.+)$')[0].str.strip()

# çµ±è¨ˆä¸¦æ’åº
summary = names.value_counts().reset_index()
summary.columns = ['å§“å', 'æ¬¡æ•¸']

# åŠ ç¸½
total = summary['æ¬¡æ•¸'].sum()
summary.loc[len(summary)] = ['ç¸½è¨ˆ', total]

"""## Step 4ï¼šç”¢å‡ºæ–°çš„ Excel ä¸¦ä¸‹è¼‰"""

output_file = "ç”¢å‡ºå ±è¡¨.xlsx"
with pd.ExcelWriter(output_file, engine='openpyxl') as writer:
    summary.to_excel(writer, sheet_name='å·¥ä½œè¡¨2', startrow=2, startcol=1, index=False)
    ws = writer.sheets['å·¥ä½œè¡¨2']
    ws['B2'] = 'å§“å'
    ws['C2'] = 'æ¬¡æ•¸'

# ä¸‹è¼‰æª”æ¡ˆ
files.download(output_file)